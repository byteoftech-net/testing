<!DOCTYPE html>
<script>
fetch('https://corsproxy.io/?' + encodeURIComponent('https://old.reddit.com/r/tearsofthekingdom/')).then(function (response) {
  // The API call was successful!
  return response.text();
}).then(function (html) {
  // Convert the HTML string into a document object
  var parser = new DOMParser();
  var doc = parser.parseFromString(html, 'text/html');

  // Select all post elements
  var postElements = doc.querySelectorAll('.thing.link');

  // Array to store post data
  var postData = [];

  // Loop through each post element
  postElements.forEach(function (post) {
    // Extract relevant information
    var title = post.querySelector('.title').textContent.trim();
    var author = post.getAttribute('data-author');
    var time = post.querySelector('time').getAttribute('datetime');
    var authorRank = post.querySelector('.author').classList.contains('moderator') ? 'moderator' : 'regular';
    var subreddit = post.getAttribute('data-subreddit');
    var commentCount = parseInt(post.getAttribute('data-comments-count'));
    var isAnnouncement = post.querySelector('.stickied-tagline') !== null;
    var upvoteCount = parseInt(post.querySelector('.score.likes').textContent);
    var downvoteCount = parseInt(post.querySelector('.score.dislikes').textContent);
    var postUrl = 'https://old.reddit.com' + post.getAttribute('data-permalink');

    // Create post object
    var postObject = {
      title: title,
      author: author,
      time: time,
      authorRank: authorRank,
      subreddit: subreddit,
      commentCount: commentCount,
      isAnnouncement: isAnnouncement,
      upvoteCount: upvoteCount,
      downvoteCount: downvoteCount,
      url: postUrl
    };

    // Push post object to postData array
    postData.push(postObject);
  });

  // Convert postData to JSON and log it
  var jsonData = JSON.stringify(postData, null, 2);
  console.log(jsonData);
}).catch(function (err) {
  // There was an error
  console.error('Something went wrong.', err);
});
</script>
